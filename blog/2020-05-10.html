<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Arena Lineups and State Transitions - 2020-05-10</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.2/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.2/highlight.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script>hljs.initHighlightingOnLoad();</script>
<style>
th, td {
  padding: 3px;
}
</style>
</head>
<body>
  <h1>Arena Lineups and State Transitions</h1>
  <p>In a <a href="https://www.ssbwiki.com/Super_Smash_Bros._Ultimate">video game I've played a lot recently</a> there are online arenas where players line up, the two people at the front of the line fight, then the loser goes to the back of the line. Even with a relatively large skill gap between players there's some (non-zero) chance either player could win. How often does the best player get to play? How often does each line up happen?</p>

  <h2>How often do you play if you always have an X% chance of winning?</h2>
  <p>How often does a particular player play, if they have the same chance of winning against any opponent? Let's assume they have a 70% chance of winning each game in an arena with 8 players. The chance of them winning 1 game is 0.7. The chance of them winning 2 games is 0.7<sup>2</sup>. The chance of them winning N games is 0.7<sup>N</sup>. The average number of games they will win in a row is 0.7 + 0.7<sup>2</sup> + 0.7<sup>3</sup> + ... + 0.7<sup>N</sup> for N going all the way to infinity. After winning some games, they'll lose 1 game and go to the back of the line, so the total number of games they play before going to the back of the line is \( 1 + 0.7 + 0.7^2 + ... = 0.7^0 + 0.7^1 + 0.7^2 + ... = \sum_{k=0}^\infty 0.7^k = \frac{1}{1 - 0.7} = 3.\overline{3}\) games. Every time that player loses, they have to sit out 8 - 2 = 6 games before they can play again. On average, our player will play 3.<span style="text-decoration:overline">3</span> games, then wait in line for 6 games, so they are playing 3.<span style="text-decoration:overline">3</span> / (3.<span style="text-decoration:overline">3</span> + 6) &asymp; 0.357 (35.7%) of the time. Now lets generalize, instead of assuming their <code>win_ratio</code> = 0.7 and the <code>arena_capacity</code> = 8. The number of games they play on average is \( \frac{1}{1 - \text{win_ratio}} \) before going to the back of the line. Once they're at the back of the line, they will have to site out of <code>arena_capacity</code> - 2 games until they are one of the two people at the front of the line who get to play again. They play this much on average: \[ \frac{\frac{1}{1 - \text{win_ratio}}}{\frac{1}{1 - \text{win_ratio}} + \text{arena_capacity} - 2} \] </p>
  <table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /><col width="58" /></colgroup>
  <tbody>
  <tr>
  <td></td>
  <td style="font-weight: bold; text-align: center;" colspan="11" rowspan="1" >win_ratio</td>
  </tr>
  <tr>
  <td style="font-weight: bold;" >capacity</td>
  <td style="font-weight: bold;" >0</td>
  <td style="font-weight: bold;">0.1</td>
  <td style="font-weight: bold;">0.2</td>
  <td style="font-weight: bold;">0.3</td>
  <td style="font-weight: bold;">0.4</td>
  <td style="font-weight: bold;">0.5</td>
  <td style="font-weight: bold;">0.6</td>
  <td style="font-weight: bold;">0.7</td>
  <td style="font-weight: bold;">0.8</td>
  <td style="font-weight: bold;">0.9</td>
  <td style="font-weight: bold;">1</td>
  </tr>
  <tr>
  <td style="font-weight: bold;" >2</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #dae9d2;">1.000</td>
  <td style="background-color: #dae9d2;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  <td style="background-color: #d9ead3;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">3</td>
  <td style="background-color: #e9d8ce;">0.500</td>
  <td style="background-color: #e8d9cf;">0.526</td>
  <td style="background-color: #e7dacf;">0.556</td>
  <td style="background-color: #e6dbcf;">0.588</td>
  <td style="background-color: #e5dccf;">0.625</td>
  <td style="background-color: #e4ded0;">0.667</td>
  <td style="background-color: #e2e0d0;">0.714</td>
  <td style="background-color: #e1e1d1;">0.769</td>
  <td style="background-color: #dfe4d1;">0.833</td>
  <td style="background-color: #dce6d2;">0.909</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">4</td>
  <td style="background-color: #efd2cd;">0.333</td>
  <td style="background-color: #eed3cd;">0.357</td>
  <td style="background-color: #edd4cd;">0.385</td>
  <td style="background-color: #ecd5ce;">0.417</td>
  <td style="background-color: #ebd6ce;">0.455</td>
  <td style="background-color: #e9d8ce;">0.500</td>
  <td style="background-color: #e7dacf;">0.556</td>
  <td style="background-color: #e5dccf;">0.625</td>
  <td style="background-color: #e2e0d0;">0.714</td>
  <td style="background-color: #dfe4d1;">0.833</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">5</td>
  <td style="background-color: #f1cfcc;">0.250</td>
  <td style="background-color: #f0d0cd;">0.270</td>
  <td style="background-color: #f0d1cd;">0.294</td>
  <td style="background-color: #efd2cd;">0.323</td>
  <td style="background-color: #eed3cd;">0.357</td>
  <td style="background-color: #ecd5ce;">0.400</td>
  <td style="background-color: #ebd6ce;">0.455</td>
  <td style="background-color: #e8d9cf;">0.526</td>
  <td style="background-color: #e5dccf;">0.625</td>
  <td style="background-color: #e1e1d1;">0.769</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">6</td>
  <td style="background-color: #f3cecc;">0.200</td>
  <td style="background-color: #f2cecc;">0.217</td>
  <td style="background-color: #f2cfcc;">0.238</td>
  <td style="background-color: #f1d0cc;">0.263</td>
  <td style="background-color: #f0d1cd;">0.294</td>
  <td style="background-color: #efd2cd;">0.333</td>
  <td style="background-color: #edd4cd;">0.385</td>
  <td style="background-color: #ebd6ce;">0.455</td>
  <td style="background-color: #e8dacf;">0.556</td>
  <td style="background-color: #e3dfd0;">0.714</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">7</td>
  <td style="background-color: #f4cccc;">0.167</td>
  <td style="background-color: #f3cdcc;">0.182</td>
  <td style="background-color: #f3cecc;">0.200</td>
  <td style="background-color: #f2cecc;">0.222</td>
  <td style="background-color: #f1cfcc;">0.250</td>
  <td style="background-color: #f0d1cd;">0.286</td>
  <td style="background-color: #efd2cd;">0.333</td>
  <td style="background-color: #ecd5ce;">0.400</td>
  <td style="background-color: #e9d8ce;">0.500</td>
  <td style="background-color: #e4ded0;">0.667</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">8</td>
  <td style="background-color: #f4cccc;">0.143</td>
  <td style="background-color: #f4cccc;">0.156</td>
  <td style="background-color: #f4cdcc;">0.172</td>
  <td style="background-color: #f3cdcc;">0.192</td>
  <td style="background-color: #f2cecc;">0.217</td>
  <td style="background-color: #f1cfcc;">0.250</td>
  <td style="background-color: #f0d1cd;">0.294</td>
  <td style="background-color: #eed3cd;">0.357</td>
  <td style="background-color: #ebd6ce;">0.455</td>
  <td style="background-color: #e5dccf;">0.625</td>
  <td style="background-color: #dae9d2;">1.000</td>
  </tr>
  </tbody>
  </table>

  <h2>What if every player has an X% chance against players below them?</h2>
  <p>What if every player has an X% chance against players below them? How often does everyone get to play? For the best player, this is the same situation as before: they always have an X% chance of winning. For everyone else, we have to care about the order of players: the entire lineup/state is important. Let's use a quick little simulation: start with an arbitrary lineup and just play the games out, keeping track of how many games each player gets to play. Since there's no player that always wins (or always loses), all possible lineups can be reached and eventually will get reached if the simulation runs long enough.</p>
  <pre><code class="python">import random

win_ratio = 0.7
arena_capacity = 8

# Our lineup is a list of players.
# Each player is just an integer from 0 to arena_capacity - 1
# If a player is "less than" another player, it has win_ratio chance to win
# e.g. 0 always has win_ratio chance to win but arena_capacity - 1 never does.
lineup = list(range(arena_capacity))
random.shuffle(lineup)

games_per_player = [0 for _ in lineup]

# Simulate 1,000,000 games
for _ in range(1_000_000):
  p1 = lineup[0]
  p2 = lineup[1]
  games_per_player[p1] += 1
  games_per_player[p2] += 1
  prob_p1_wins = win_ratio if p1 < p2 else 1 - win_ratio
  if random.random() < prob_p1_wins:
    # lineup[0] won, so lineup[1] goes to the back of the line
    lineup = lineup[:1] + lineup[2:] + lineup[1:2]
  else:
    # lineup[1] won, so lineup[0] goes to the back of the line
    lineup = lineup[1:] + lineup[0:1]

total_games = sum(games_per_player) // 2
for player in sorted(lineup):
  print(f'Player {p} played {games_per_player[p] / total_games} of total games')
</code></pre>
<pre><output>Player 0 played 0.357041 of total games
Player 1 played 0.304571 of total games
Player 2 played 0.26735 of total games
Player 3 played 0.242306 of total games
Player 4 played 0.224655 of total games
Player 5 played 0.211372 of total games
Player 6 played 0.200611 of total games
Player 7 played 0.192094 of total games</output></pre>
  <p>This simulation is imperfect but gives us a good approximation. Player 0's "0.357041" from the simulation matches true value we calculated earlier to 5 decimal places: 0.357143. It also happens to use on the order of <code>arena_capacity</code> memory and N time where N is the number of games simulated.</p>
  <p>We can do better, in terms of accuracy! The simple simulation is fairly straightforward to implement and understand but it's not very accurate because it's essentially taking a random walk. In particular, this simulation isn't good at capturing rare events. We can improve this by keeping track of all of the possibilities. Imagine we started with a particular lineup with just 3 players in the lineup [0, 1, 2] (0 being the best player and 3 being the worst). If player 0 has a 70% chance of winning, we'd like to keep track of the fact that after 1 round there's a 70% chance of lineup [0, 2, 1] and a 30% chance of lineup [1, 2, 0].</p>
  <table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="68" /><col width="68" /><col width="68" /><col width="68" /><col width="68" /><col width="68" /><col width="68" /></colgroup>
  <tbody>
  <tr>
  <td></td>
  <td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1">Lineup</td>
  </tr>
  <tr>
  <td >Game</td>
  <td style="font-weight: bold;">[0, 1, 2]</td>
  <td style="font-weight: bold;">[0, 2, 1]</td>
  <td style="font-weight: bold;">[1, 0, 2]</td>
  <td style="font-weight: bold;">[1, 2, 0]</td>
  <td style="font-weight: bold;">[2, 0, 1]</td>
  <td style="font-weight: bold;">[2, 1, 0]</td>
  </tr>
  <tr>
  <td style="font-weight: bold;" >0</td>
  <td style="background-color: #57bb8a;">1.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">1</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #8ad0ae;">0.7000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #cdebdc;">0.3000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #ffffff;">0.0000</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">2</td>
  <td style="background-color: #addec6;">0.4900</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #dcf1e7;">0.2100</td>
  <td style="background-color: #ffffff;">0.0000</td>
  <td style="background-color: #f0f9f5;">0.0900</td>
  <td style="background-color: #dcf1e7;">0.2100</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">3</td>
  <td style="background-color: #f5fbf8;">0.0630</td>
  <td style="background-color: #addec6;">0.4900</td>
  <td style="background-color: #e7f6ee;">0.1470</td>
  <td style="background-color: #dcf1e7;">0.2100</td>
  <td style="background-color: #f5fbf8;">0.0630</td>
  <td style="background-color: #fbfefc;">0.0270</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">4</td>
  <td style="background-color: #bee5d2;">0.3871</td>
  <td style="background-color: #e7f6ee;">0.1470</td>
  <td style="background-color: #e4f4ec;">0.1659</td>
  <td style="background-color: #f5fbf8;">0.0630</td>
  <td style="background-color: #f4fbf7;">0.0711</td>
  <td style="background-color: #e4f4ec;">0.1659</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">5</td>
  <td style="background-color: #e6f5ee;">0.1527</td>
  <td style="background-color: #bee5d2;">0.3871</td>
  <td style="background-color: #e5f5ed;">0.1602</td>
  <td style="background-color: #e4f4ec;">0.1659</td>
  <td style="background-color: #f4fbf7;">0.0687</td>
  <td style="background-color: #f5fbf8;">0.0654</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">6</td>
  <td style="background-color: #caeada;">0.3190</td>
  <td style="background-color: #dbf1e6;">0.2190</td>
  <td style="background-color: #e4f4ed;">0.1619</td>
  <td style="background-color: #f0f9f5;">0.0939</td>
  <td style="background-color: #f4fbf7;">0.0694</td>
  <td style="background-color: #e9f6f0;">0.1367</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">7</td>
  <td style="background-color: #def2e8;">0.2019</td>
  <td style="background-color: #c7e9d8;">0.3367</td>
  <td style="background-color: #e4f5ed;">0.1614</td>
  <td style="background-color: #e7f6ef;">0.1443</td>
  <td style="background-color: #f4fbf7;">0.0692</td>
  <td style="background-color: #f1faf5;">0.0865</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">8</td>
  <td style="background-color: #d0ecde;">0.2841</td>
  <td style="background-color: #d5eee2;">0.2543</td>
  <td style="background-color: #e4f5ed;">0.1616</td>
  <td style="background-color: #edf8f3;">0.1090</td>
  <td style="background-color: #f4fbf7;">0.0692</td>
  <td style="background-color: #ebf7f1;">0.1218</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">9</td>
  <td style="background-color: #d9f0e5;">0.2265</td>
  <td style="background-color: #cbeadb;">0.3120</td>
  <td style="background-color: #e4f5ed;">0.1615</td>
  <td style="background-color: #e9f6f0;">0.1337</td>
  <td style="background-color: #f4fbf7;">0.0692</td>
  <td style="background-color: #eff9f4;">0.0971</td>
  </tr>
  <tr>
  <td style="font-weight: bold;">10</td>
  <td style="background-color: #d3ede0;">0.2668</td>
  <td style="background-color: #d2ede0;">0.2716</td>
  <td style="background-color: #e4f5ed;">0.1615</td>
  <td style="background-color: #ecf8f2;">0.1164</td>
  <td style="background-color: #f4fbf7;">0.0692</td>
  <td style="background-color: #ecf8f2;">0.1144</td>
  </tr>
  </tbody>
  </table>
  <p>Here's an implementation of the more complex but accurate simulation for 8 players:</p>
  <pre><code class="python">import collections
import itertools

win_ratio = 0.7
arena_capacity = 8

# The probability of being in a particular lineup
lineups = set(itertools.permutations(range(arena_capacity)))
# In this simulation, every lineup is equally possible
lineup_probabilities = {lu: 1 / len(lineups) for lu in lineups}

def print_ratio_of_games_players_play(lineup_probabilities):
  prob_playing = {lu[0]: 0 for lu in lineup_probabilities.keys()}
  for lineup, prob in lineup_probabilities.items():
    prob_playing[lineup[0]] += prob
    prob_playing[lineup[1]] += prob
  for player, prob in sorted(prob_playing.items()):
    print(player, prob)


print(f'In a an arena with {arena_capacity} players,')
print(f'where better players have a {win_ratio} chance of winning...')
for iteration in range(1000):
  print(f'Each player has this chance of playing game {iteration}')
  print_ratio_of_games_players_play(lineup_probabilities)
  print()

  # Calculate the lineup lineup_probabilities after the current game.
  next_lineup_probs = {lu: 0 for lu in lineups}
  for lineup, prob in lineup_probabilities.items():
    p1 = lineup[0]
    p2 = lineup[1]

    prob_p1_wins = win_ratio if p1 < p2 else 1 - win_ratio
    p1_wins_lineup = lineup[:1] + lineup[2:] + lineup[1:2]
    next_lineup_probs[p1_wins_lineup] += prob * prob_p1_wins

    prob_p2_wins = 1 - prob_p1_wins
    p2_wins_lineup = lineup[1:] + lineup[0:1]
    next_lineup_probs[p2_wins_lineup] += prob * prob_p2_wins
  lineup_probabilities = next_lineup_probs
</code></pre>
<pre><output>In a an arena with 8 players,
where better players have a 0.7 chance of winning...
Each player has this chance of playing game 0:
0 0.24999999999999914
1 0.24999999999999914
2 0.24999999999999914
3 0.24999999999999914
4 0.24999999999999914
5 0.24999999999999914
6 0.24999999999999914
7 0.24999999999999914

Each player has this chance of playing game 1:
0 0.3000000000000203
1 0.2857142857142995
2 0.2714285714285791
3 0.2571428571428588
4 0.24285714285713933
5 0.22857142857141902
6 0.21428571428570053
7 0.199999999999982

...

Each player has this chance of playing game 10:
0 0.34335874584999987
1 0.30313098115000037
2 0.2755610298499994
3 0.2524433838357137
4 0.23162117453571385
5 0.21297234892142886
6 0.1969404855071409
7 0.18397185034999944

...

Each player has this chance of playing game 100:
0 0.3571425608770196
1 0.30357771182616267
2 0.2677469842160434
3 0.24285737218990014
4 0.22564765729531372
5 0.2121941735007292
6 0.20012444622327458
7 0.1907090938715585

...

Each player has this chance of playing game 999:
0 0.35714285714285826
1 0.3035714285714283
2 0.26785714285714246
3 0.24285714285714252
4 0.22467532467532436
5 0.21103896103896144
6 0.20054945054943057
7 0.19230769230771042
</output></pre>
  <p>After simulating 100 games worth of all the possible outcomes, the predicted ratio of games the best player plays matches theoretical ratio to 6 decimal places (0.357142) and after 999 games, it matches up to 13 decimal places (0.35714285714285). However, it requires keeping track of every possible lineup after every game and since all lineups are eventually possible, there are S = <code>factorial(arena_capacity)</code> = 8! = 40,320 lineups/states to keep track of as opposed to the simple simulation from earlier that only has to keep track of the 'current' lineup/state. It takes on the order of S N time to simulate S games simultaneously N times, so it arguably takes "on the order of N time to simulate N total games".</p>

  <h3>Lineup Probabilities</h3>
  <p>Adding on a small bit of code to the end to print out the lineups sorted by probability shows that the most popular lineup is [0, 7, 6, 5, 4, 3, 2, 1] and the least popular is it's opposite, [7, 0, 1, 2, 3, 4, 5, 6].</p>
  <pre><code class="python">for lineup, prob in sorted(lineup_probabilities.items(), key=lambda lup: -lup[1]):
  print(lineup, prob)
</code></pre>
  <pre><output>(0, 7, 6, 5, 4, 3, 2, 1) 0.00045499913594621743
(0, 6, 5, 4, 3, 2, 1, 7) 0.00039031801930242854
(1, 0, 7, 6, 5, 4, 3, 2) 0.00037512030572818024
(0, 5, 4, 3, 2, 1, 7, 6) 0.0003315077259324971
(2, 1, 0, 7, 6, 5, 4, 3) 0.0003124589555428235
(0, 6, 5, 4, 3, 2, 7, 1) 0.00029280058409183026
(0, 4, 3, 2, 1, 7, 6, 5) 0.0002826173387706582
(1, 7, 0, 6, 5, 4, 3, 2) 0.0002777614405434467
(0, 1, 7, 6, 5, 4, 3, 2) 0.0002748784599086048
(3, 2, 1, 0, 7, 6, 5, 4) 0.00026449866551600515
...
(3, 7, 6, 4, 2, 5, 0, 1) 1.8456544676674505e-05
(4, 6, 5, 1, 3, 0, 7, 2) 1.8455746318601447e-05
(4, 5, 3, 1, 7, 6, 0, 2) 1.8455543611052784e-05
(3, 2, 7, 4, 1, 5, 6, 0) 1.8455440424872874e-05
(6, 7, 1, 4, 5, 3, 2, 0) 1.845525326604192e-05
(5, 7, 2, 3, 1, 0, 6, 4) 1.8454938243335214e-05
(0, 5, 1, 2, 3, 4, 7, 6) 1.84548475656733e-05
(4, 7, 5, 2, 3, 6, 1, 0) 1.845346700732128e-05
(1, 6, 7, 2, 3, 0, 5, 4) 1.845072263703833e-05
(5, 2, 1, 3, 7, 6, 4, 0) 1.8450715935717216e-05
...
(7, 6, 0, 1, 2, 3, 4, 5) 7.165412381415646e-07
(7, 0, 1, 2, 4, 3, 5, 6) 7.15385314959542e-07
(5, 6, 7, 0, 1, 2, 3, 4) 7.116445679045319e-07
(7, 0, 1, 3, 2, 4, 5, 6) 7.100718202731864e-07
(7, 0, 1, 2, 3, 5, 4, 6) 7.045636776721046e-07
(7, 0, 2, 1, 3, 4, 5, 6) 6.914352520668832e-07
(7, 0, 1, 2, 3, 4, 6, 5) 6.722921860462773e-07
(7, 1, 0, 2, 3, 4, 5, 6) 6.638508462809436e-07
(6, 7, 0, 1, 2, 3, 4, 5) 5.272934311577203e-07
(7, 0, 1, 2, 3, 4, 5, 6) 3.731504007897845e-07</output></pre>

  <h3>Rock-Paper-Scissors</h3>
  <p>This method has the side effect that it perfectly captures how often each lineup has come up (on average) after N games (given the probabilities of the starting lineup), so if you had a set of players that played like rock-paper-scissors, the simulation would never converge (unless the starting lineup probabilites are already converged).</p>
  <pre><code class="python">import collections
import itertools

# The probability of being in a particular lineup
lineups = set(itertools.permutations(['rock', 'paper', 'scissors']))
# In this simulation, we start the first game with a particular lineup
lineup_probabilities = {lu: 0 for lu in lineups}
lineup_probabilities['rock', 'paper', 'scissors'] = 1

def print_ratio_of_games_players_play(lineup_probabilities):
  prob_playing = {lu[0]: 0 for lu in lineup_probabilities.keys()}
  for lineup, prob in lineup_probabilities.items():
    prob_playing[lineup[0]] += prob
    prob_playing[lineup[1]] += prob
  for player, prob in sorted(prob_playing.items()):
    print(player, prob)


for iteration in range(1000):
  print(f'Each player has this chance of playing game {iteration}')
  print_ratio_of_games_players_play(lineup_probabilities)
  print()

  # Calculate the lineup lineup_probabilities after the current game.
  next_lineup_probs = {lu: 0 for lu in lineups}
  for lineup, prob in lineup_probabilities.items():
    p1 = lineup[0]
    p2 = lineup[1]

    prob_p1_wins = 1 if (p1, p2) in [
        ('rock', 'scissors'), ('scissors', 'paper'), ('paper', 'rock')] else 0
    p1_wins_lineup = lineup[:1] + lineup[2:] + lineup[1:2]
    next_lineup_probs[p1_wins_lineup] += prob * prob_p1_wins

    prob_p2_wins = 1 - prob_p1_wins
    p2_wins_lineup = lineup[1:] + lineup[0:1]
    next_lineup_probs[p2_wins_lineup] += prob * prob_p2_wins
  lineup_probabilities = next_lineup_probs
</code></pre>
<pre><output>Each player has this chance of playing game 0
paper 1
rock 1
scissors 0

Each player has this chance of playing game 1
paper 1
rock 0
scissors 1

Each player has this chance of playing game 2
paper 0
rock 1
scissors 1

Each player has this chance of playing game 3
paper 1
rock 1
scissors 0
</output></pre>

  <h2>What if there's a matchup table for <code>win_ratio</code>?</h2>
  <p>Nothing changes! The only change you need to make to the code is how <code>prob_p1_wins</code> is calculated.</p>

  <h2>Vectors and Matrices</h2>
  <h3>State Transistion Matrix</h3>
  <p>The simulation works by having a vector where each index represents a state (lineup) and each value represents the probability of being in that state. Each iteration of the algorithm (each game played) does is a linear transformation from the initial state probability vector to the next one. It's the same as multiplying our vector of states by a matrix that represents the probabilities of each state going to another state. For an 8 person arena, there are 8! lineups, so the state transition matrix must have \( S^2 = 8!^2 = 1,625,702,400\) total vlues. Here's a matrix representing a 3-person arena where better players (players with a lower number) have a 0.7 chance of winning: </p>
  <table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="61" /><col width="113" /><col width="113" /><col width="113" /><col width="113" /><col width="113" /><col width="113" /></colgroup>
  <tbody>
  <tr>
  <td style="font-weight: bold; text-align: center;" colspan="1" rowspan="2" >
  <div style="max-height: 42px;">ending<br />state</div>
  </td>
  <td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1" >starting state</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[0, 1, 2]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[0, 1, 2]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[0, 1, 2]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[0, 1, 2]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[0, 1, 2]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[0, 1, 2]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[0, 2, 1]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[0, 2, 1]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[0, 2, 1]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[0, 2, 1]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[0, 2, 1]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[0, 2, 1]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[1, 0, 2]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[1, 0, 2]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[1, 0, 2]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[1, 0, 2]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[1, 0, 2]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[1, 0, 2]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[1, 2, 0]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[1, 2, 0]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[1, 2, 0]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[1, 2, 0]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[1, 2, 0]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[1, 2, 0]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[2, 0, 1]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[2, 0, 1]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[2, 0, 1]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[2, 0, 1]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[2, 0, 1]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[2, 0, 1]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="text-align: center;">[0, 1, 2]&rarr;[2, 1, 0]</td>
  <td style="text-align: center;">[0, 2, 1]&rarr;[2, 1, 0]</td>
  <td style="text-align: center;">[1, 0, 2]&rarr;[2, 1, 0]</td>
  <td style="text-align: center;">[1, 2, 0]&rarr;[2, 1, 0]</td>
  <td style="text-align: center;">[2, 0, 1]&rarr;[2, 1, 0]</td>
  <td style="text-align: center;">[2, 1, 0]&rarr;[2, 1, 0]</td>
  </tr>
  </tbody>
  </table>

  <table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="67" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /></colgroup>
  <tbody>
  <tr>
  <td style="font-weight: bold; text-align: center;" colspan="1" rowspan="2" >
  <div style="max-height: 42px;">ending<br />state</div>
  </td>
  <td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1" >starting state</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  </tr>
  </tbody>
  </table>

  <p>Overall, the size of this matrix is much larger than the size of a single vector but it does have one big speed advantage. If you have the current vector representing the probability of being in each possible state, \( x \), and the state transition matrix, \( A \), then the probability of being in each state after one game/transition is \( A x \). The probability of being in each state after 2 transistions it's \( A (A x) = A^2 x \) and the probability of being in each state after \( N \) transitions is \( A^N x \). In general, if there are \( S \) states, then multiplying \( A \), an SxS matrix, would take on the order of \( S^3 \) operations, so figuring out the probability of being in each state \( N \) transitions later would take on the order of \( N S^3 \) steps to calculate \( A^N \) and needs on the order of \( S^2 \) memory for the state transition matrix. We can make it take on the order of \( \log_2(N) S^3 \) steps by using <a href="https://en.wikipedia.org/wiki/Exponentiation_by_squaring">exponentiation by squaring</a>. Here's some sample code to demonstrate, using <code>arena_capacity = 3</code>, so it's easy to see the entire transition matrix... and to not use too much memory on my computer.</p>

  <table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="67" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /></colgroup>
  <tbody>
  <tr>
  <td style="font-weight: bold; text-align: center;" colspan="1" rowspan="2" >
  <div style="max-height: 42px;">ending<br />state</div>
  </td>
  <td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1" >starting state</td>
  <td style="font-weight: bold; text-align: center;" >Power</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="font-weight: bold; text-align: center;" >1</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #57bb8a; text-align: center;" >0.7</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
  <td style="background-color: #ffffff; text-align: center;" >0</td>
  <td></td>
  </tr>
  <tr>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="font-weight: bold; text-align: center;">2</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td style="background-color: #8ad0ae; text-align: center;">0.49</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #cdebdc; text-align: center;">0.21</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td style="background-color: #ffffff; text-align: center;">0</td>
  <td style="background-color: #eaf7f0; text-align: center;">0.09</td>
  <td></td>
  </tr>
  <tr>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="font-weight: bold; text-align: center;">4</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td style="background-color: #a3dabf; text-align: center;">0.3871</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #dcf1e7; text-align: center;">0.147</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td style="background-color: #d8efe4; text-align: center;">0.1659</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td style="background-color: #f0f9f5; text-align: center;">0.063</td>
  <td style="background-color: #eef9f4; text-align: center;">0.0711</td>
  <td></td>
  </tr>
  <tr>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
  <td style="background-color: #bbe4d0; text-align: center;">0.28410151</td>
  <td style="background-color: #c9eada; text-align: center;">0.2264535</td>
  <td style="background-color: #bbe4d0; text-align: center;">0.28410151</td>
  <td style="background-color: #c9e9da; text-align: center;">0.22660659</td>
  <td style="background-color: #c9eada; text-align: center;">0.2264535</td>
  <td style="background-color: #c9e9da; text-align: center;">0.22660659</td>
  <td style="font-weight: bold; text-align: center;">8</td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
  <td style="background-color: #c2e7d5; text-align: center;">0.2543247</td>
  <td style="background-color: #b5e1cb; text-align: center;">0.31197271</td>
  <td style="background-color: #c2e7d5; text-align: center;">0.2543247</td>
  <td style="background-color: #b5e1cb; text-align: center;">0.31197271</td>
  <td style="background-color: #b5e1cb; text-align: center;">0.31197271</td>
  <td style="background-color: #b5e1cb; text-align: center;">0.31197271</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
  <td style="background-color: #d9f0e4; text-align: center;">0.16157379</td>
  <td style="background-color: #d9f0e4; text-align: center;">0.16157379</td>
  <td style="background-color: #d9f0e4; text-align: center;">0.16157379</td>
  <td style="background-color: #d9f0e5; text-align: center;">0.1614207</td>
  <td style="background-color: #d9f0e4; text-align: center;">0.16157379</td>
  <td style="background-color: #d9f0e5; text-align: center;">0.1614207</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
  <td style="background-color: #e5f5ed; text-align: center;">0.1089963</td>
  <td style="background-color: #dff3e9; text-align: center;">0.13370259</td>
  <td style="background-color: #e5f5ed; text-align: center;">0.1089963</td>
  <td style="background-color: #dff3e9; text-align: center;">0.13370259</td>
  <td style="background-color: #dff3e9; text-align: center;">0.13370259</td>
  <td style="background-color: #dff3e9; text-align: center;">0.13370259</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
  <td style="background-color: #eff9f4; text-align: center;">0.06924591</td>
  <td style="background-color: #eff9f4; text-align: center;">0.06924591</td>
  <td style="background-color: #eff9f4; text-align: center;">0.06924591</td>
  <td style="background-color: #eff9f4; text-align: center;">0.0691803</td>
  <td style="background-color: #eff9f4; text-align: center;">0.06924591</td>
  <td style="background-color: #eff9f4; text-align: center;">0.0691803</td>
  <td></td>
  </tr>
  <tr>
  <td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
  <td style="background-color: #e2f4eb; text-align: center;">0.12175779</td>
  <td style="background-color: #e8f6ef; text-align: center;">0.0970515</td>
  <td style="background-color: #e2f4eb; text-align: center;">0.12175779</td>
  <td style="background-color: #e8f6ef; text-align: center;">0.09711711</td>
  <td style="background-color: #e8f6ef; text-align: center;">0.0970515</td>
  <td style="background-color: #e8f6ef; text-align: center;">0.09711711</td>
  <td></td>
  </tr>
  </tbody>
  </table>

  <pre><code class="python">import itertools

import numpy
import numpy.linalg

arena_capacity = 3
win_ratio = 0.7
# Each player is represented as a number in [0, arena_capacity).
# Smaller number players have win_ratio chance of winning.
lineups = sorted(itertools.permutations(range(arena_capacity)))

def transition_probability(start_lineup, end_lineup, win_ratio):
  p1 = start_lineup[0]
  p2 = start_lineup[1]
  winner = end_lineup[0]
  loser = end_lineup[-1]
  prob_p1_wins = win_ratio if p1 < p2 else 1 - win_ratio
  if start_lineup[2:] == end_lineup[1:-1]:
    if winner == p1:
      assert loser == p2
      return prob_p1_wins
    elif winner == p2:
      assert loser == p1
      return 1 - prob_p1_wins
  return 0

# Note: This can be optimized by creating a matrix of all 0's, then filling
# in the non-zero probabilities since there are relatively fewer of them.
lineup_transition_matrix = numpy.array(
  [[transition_probability(start_lineup, end_lineup, win_ratio)
      for start_lineup in lineups]
        for end_lineup in lineups])

# In this simulation, each starting lineup is equally possible.
prob_in_lineup = numpy.array([1 / len(lineups) for _ in lineups])
transitions_so_far = 0
transitions_per_multiplication = 1
for i in range(20):
  # Sum up how often each player played based on how often each lineup happened
  prob_player_playing = [0 for _ in range(arena_capacity)]
  for lineup, prob in zip(lineups, prob_in_lineup):
    prob_player_playing[lineup[0]] += prob
    prob_player_playing[lineup[1]] += prob
  print(f'Transition matrix (for {transitions_per_multiplication} games):')
  print(lineup_transition_matrix)
  print(f'After playing {transitions_so_far} games each player has played:')
  for player, prob in enumerate(prob_player_playing):
    print(player, prob)
  print()

  # Play some more games
  prob_in_lineup = numpy.matmul(lineup_transition_matrix, prob_in_lineup)
  transitions_so_far += transitions_per_multiplication
  lineup_transition_matrix = numpy.linalg.matrix_power(lineup_transition_matrix, 2)
  transitions_per_multiplication *= 2
</code></pre>
<pre><output>Transition matrix (for 1 games):
[[ 0.   0.7  0.   0.   0.7  0. ]
 [ 0.7  0.   0.7  0.   0.   0. ]
 [ 0.   0.   0.   0.7  0.   0.7]
 [ 0.3  0.   0.3  0.   0.   0. ]
 [ 0.   0.   0.   0.3  0.   0.3]
 [ 0.   0.3  0.   0.   0.3  0. ]]
After playing 0 games each player has played:
0 0.666666666667
1 0.666666666667
2 0.666666666667

Transition matrix (for 2 games):
[[ 0.49  0.    0.49  0.21  0.    0.21]
 [ 0.    0.49  0.    0.49  0.49  0.49]
 [ 0.21  0.21  0.21  0.    0.21  0.  ]
 [ 0.    0.21  0.    0.21  0.21  0.21]
 [ 0.09  0.09  0.09  0.    0.09  0.  ]
 [ 0.21  0.    0.21  0.09  0.    0.09]]
After playing 1 games each player has played:
0 0.8
1 0.666666666667
2 0.533333333333

Transition matrix (for 4 games):
[[ 0.3871  0.147   0.3871  0.1659  0.147   0.1659]
 [ 0.147   0.3871  0.147   0.3871  0.3871  0.3871]
 [ 0.1659  0.1659  0.1659  0.147   0.1659  0.147 ]
 [ 0.063   0.1659  0.063   0.1659  0.1659  0.1659]
 [ 0.0711  0.0711  0.0711  0.063   0.0711  0.063 ]
 [ 0.1659  0.063   0.1659  0.0711  0.063   0.0711]]
After playing 3 games each player has played:
0 0.772
1 0.666666666667
2 0.561333333333

...

Transition matrix (for 128 games):
[[ 0.25022624  0.25022624  0.25022624  0.25022624  0.25022624  0.25022624]
 [ 0.28823529  0.28823529  0.28823529  0.28823529  0.28823529  0.28823529]
 [ 0.16153846  0.16153846  0.16153846  0.16153846  0.16153846  0.16153846]
 [ 0.12352941  0.12352941  0.12352941  0.12352941  0.12352941  0.12352941]
 [ 0.06923077  0.06923077  0.06923077  0.06923077  0.06923077  0.06923077]
 [ 0.10723982  0.10723982  0.10723982  0.10723982  0.10723982  0.10723982]]
After playing 127 games each player has played:
0 0.769230769231
1 0.642533936652
2 0.588235294118

...

Transition matrix (for 262144 games):
[[ 0.25022624  0.25022624  0.25022624  0.25022624  0.25022624  0.25022624]
 [ 0.28823529  0.28823529  0.28823529  0.28823529  0.28823529  0.28823529]
 [ 0.16153846  0.16153846  0.16153846  0.16153846  0.16153846  0.16153846]
 [ 0.12352941  0.12352941  0.12352941  0.12352941  0.12352941  0.12352941]
 [ 0.06923077  0.06923077  0.06923077  0.06923077  0.06923077  0.06923077]
 [ 0.10723982  0.10723982  0.10723982  0.10723982  0.10723982  0.10723982]]
After playing 262143 games each player has played:
0 0.769230769228
1 0.642533936649
2 0.588235294116

Transition matrix (for 524288 games):
[[ 0.25022624  0.25022624  0.25022624  0.25022624  0.25022624  0.25022624]
 [ 0.28823529  0.28823529  0.28823529  0.28823529  0.28823529  0.28823529]
 [ 0.16153846  0.16153846  0.16153846  0.16153846  0.16153846  0.16153846]
 [ 0.12352941  0.12352941  0.12352941  0.12352941  0.12352941  0.12352941]
 [ 0.06923077  0.06923077  0.06923077  0.06923077  0.06923077  0.06923077]
 [ 0.10723982  0.10723982  0.10723982  0.10723982  0.10723982  0.10723982]]
After playing 524287 games each player has played:
0 0.769230769226
1 0.642533936647
2 0.588235294114
</output></pre>

<h3>System of Linear Equations</h3>
<p>If what we care about most is calculating the probability of certain lineups/states, we can do even better by thinking of the matrix as a system of linear equations. The state transition matrix can also be thought of as representing the probability of being in each state as a linear combination of the the probability of being in other states. For example, in the matrix below / from earlier, the probability of being in state [0, 1, 2] in the next game is 0.7 times the probability of being in state [0, 2, 1] the previous game plus 0.7 times the probability of being in state [2, 0, 1] the previous game.</p>
<table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="67" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /></colgroup>
<tbody>
<tr>
<td style="font-weight: bold; text-align: center;" colspan="1" rowspan="2" >
<div style="max-height: 42px;">ending<br />state</div>
</td>
<td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1" >starting state</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
<td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
<td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
<td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
<td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
<td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
</tbody>
</table>

<p>If we assume that the probability of being in a given state doesn't actually change over time, then we can treat this as a system of linear equations to be solved. In other words, the probability of being in being in state [0, 1, 2] in general is 0.7 times the probability of being in state [0, 2, 1] in general plus 0.7 times the probability of being in state [2, 0, 1] in general. \( P([0, 1, 2]) = 0.7 P([0, 2, 1]) + 0.7 P([2, 0, 1]) \). Every row in the state transition matrix represents the left hand side and every column represents the constants/coefficients of the other probabilities on the right hand side. To get the transition matrix into a matrix that represents the system of linear equations, we need to have a setup such that \( Ax = b \), where A is all of the coefficients for the probabilities and b is the value they take on. For example, if the first row of A is [-1, 0.7, 0, 0, 0.7, 0] and the first value of b is 0, that represents the idea that \( -P([0, 1, 2]) + 0.7 P([0, 2, 1]) + 0.7 P([2, 0, 1]) = 0 \) which is the same as \( P([0, 1, 2]) = 0.7 P([0, 2, 1]) + 0.7 P([2, 0, 1]) \). If we subtract the identity, \( I_6 \), from the state transition matrix and set \( b = (0, 0, 0, 0, 0, 0) \), then we've done it! The first row of A would represent \( -P([0, 1, 2]) + 0.7 P([0, 2, 1]) + 0.7 P([2, 0, 1]) = 0 \) like we want. </p>
<table dir="ltr" style="table-layout: fixed; font-size: 10pt; font-family: Arial; width: 0px; border-collapse: collapse; border: none;" border="1" cellspacing="0" cellpadding="0"><colgroup><col width="67" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /><col width="80" /></colgroup>
<tbody>
<tr>
<td style="font-weight: bold; text-align: center;" colspan="1" rowspan="2" >
<div style="max-height: 42px;">ending<br />state</div>
</td>
<td style="font-weight: bold; text-align: center;" colspan="6" rowspan="1" >starting state</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
<td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
<td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
<td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
<td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
<td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 1, 2]</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[0, 2, 1]</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[1, 0, 2]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #57bb8a; text-align: center;" >0.7</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[1, 2, 0]</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[2, 0, 1]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
</tr>
<tr>
<td style="font-weight: bold; text-align: center;">[2, 1, 0]</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #ffffff; text-align: center;" >0</td>
<td style="background-color: #b7e2cd; text-align: center;" >0.3</td>
<td style="background-color: #ffffff; text-align: center;" >-1</td>
</tr>
</tbody>
</table>

<p>Unfortunately, these aren't enough constraints to solve the problem because \( x = (0, 0, 0, ...) \) is a solution: if the probability of being in any given state is 0, then it would satisfy all those relationships. For example, if \( P([0, 2, 1]) = 0, P([2, 0, 1]) = 0 \) then \( 0 = P([0, 1, 2]) = 0.7 P([0, 2, 1]) + 0.7 P([2, 0, 1]) \) is valid. We have to add an additional constaint that the probability of being in one of our states must be 1. In other words, \( P([0, 1, 2]) + P([0, 2, 1]) + P([1, 0, 2]) + P([1, 2, 0]) + P([2, 0, 1]) + P([2, 1, 0]) = 1 \). This is equivalent to adding a row of all 1's to A and appending 1 to b. In practice, the library I use for soving the system of linear equations requires a square matrix, making adding a row impossible, so I add 1 to every cell of A and b. Adding 1 to an arbitrary row of A and corresponding value in b should also work in practice.</p>
<pre><code class="python">import itertools

import numpy
import numpy.linalg

arena_capacity = 3
win_ratio = 0.7
# Each player is represented as a number in [0, arena_capacity).
# Smaller number players have win_ratio chance of winning.
lineups = sorted(itertools.permutations(range(arena_capacity)))

def transition_probability(start_lineup, end_lineup, win_ratio):
  p1 = start_lineup[0]
  p2 = start_lineup[1]
  winner = end_lineup[0]
  loser = end_lineup[-1]
  prob_p1_wins = win_ratio if p1 < p2 else 1 - win_ratio
  if start_lineup[2:] == end_lineup[1:-1]:
    if winner == p1:
      assert loser == p2
      return prob_p1_wins
    elif winner == p2:
      assert loser == p1
      return 1 - prob_p1_wins
  return 0

lineup_transition_matrix = numpy.array(
  [[transition_probability(start_lineup, end_lineup, win_ratio)
      for start_lineup in lineups]
        for end_lineup in lineups])

# System of linear equations
sole = lineup_transition_matrix - numpy.identity(len(lineup_transition_matrix))
# Add constraint that all lineup probabilites sum to 1
sole += 1
values = numpy.ones(len(lineup_transition_matrix))
print(f'A = \n{sole}')
print(f'b = {values}')
lineup_probs = numpy.linalg.solve(sole, values)
print('x = ')
for lineup, prob in sorted(zip(lineups, lineup_probs), key=lambda lup: -lup[1]):
  print(' ', lineup, prob)
</code></pre>
<pre><output>A =
[[ 0.   1.7  1.   1.   1.7  1. ]
 [ 1.7  0.   1.7  1.   1.   1. ]
 [ 1.   1.   0.   1.7  1.   1.7]
 [ 1.3  1.   1.3  0.   1.   1. ]
 [ 1.   1.   1.   1.3  0.   1.3]
 [ 1.   1.3  1.   1.   1.3  0. ]]
b = [ 1.  1.  1.  1.  1.  1.]
x =
  (0, 2, 1) 0.288235294118
  (0, 1, 2) 0.250226244344
  (1, 0, 2) 0.161538461538
  (1, 2, 0) 0.123529411765
  (2, 1, 0) 0.107239819005
  (2, 0, 1) 0.0692307692308
</output></pre>
  <p>The result here matches the results we saw when the simulations converged and requires on the order of \( S^3 \) steps and on the order of \( S^2 \) memory to effectively simulate infinitely many games. I'm confident, but not 100% sure, this method works for state transition matrices where it's possible to reach any state from any other state but not for other state transition matrices.</p>

  <h2>Misc. Thoughts</h2>
  <p>This was fun.</p>
  <p>For most of these simulations, I used an arena size of 3 or 8 and a <code>win_ratio</code> of 0.7 but most of this generalizes quite well. For example, the tendency for lineups like (0, 7, 6, 5, 4, 3, 2, 1) to be most common still holds for other <code>win_ratio</code> values.</p>
  <p>I'd be curious to know what it is in practice and to see how the results change with a more realistic matchup table and to know what a real matchup table even looks like. In practice, players have a more loose ordering where even if a good player generally wins against a group of players, they might lose against another player that generally loses more to others.</p>
  <p>In some arenas, the arena owner will enforce a rule that if you win W times in a row, you have to go to the back of the line. I didn't get around to seeing how that affects lineup probabilities or how often particular players get to play. My guess is that if W is coprime with <code>arena_capacity</code>, then it will do a good job of giving players a more equal opportunity to play.</p>

</body>
</html>
