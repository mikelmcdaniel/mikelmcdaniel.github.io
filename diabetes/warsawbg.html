<!doctype html>
<html>
<head>
<title>Warsaw BG</title>
<meta name="viewport" content="width=device-width">
</head>
<body>

<p><label for="carb_insulin_ratio">Carb (grams) to Insulin (units) Ratio</label><input id="carb_insulin_ratio" type="text" value="14" oninput="handleInput()"></p>
<p><label for="carbs">Carbs (grams):</label><input id="carbs" type="text" value="0" oninput="handleInput()"></p>
<p><label for="fats">Fats (grams):</label><input id="fats" type="text" value="0" oninput="handleInput()"></p>
<p><label for="proteins">Proteins (grams):</label><input id="proteins" type="text" value="0" oninput="handleInput()"></p>
<p>Units to Bolus Now: <span id="bolus_now_units">N/A</span></p>
<p>Extended Bolus: <span id="extended_bolus_units">N/A</span> units over <span id="extended_bolus_hours">N/A</span> hours.</p>

<script>
function handleInput() {
  var carb_insulin_ratio = document.getElementById("carb_insulin_ratio").value;
  var carbs = document.getElementById("carbs").value;
  var fats = document.getElementById("fats").value;
  var proteins = document.getElementById("proteins").value;

  var cu = carbs / 10;
  var fpu = (4 * proteins + 9 * fats) / 100;
  var cu_rounded = Math.round(100 * cu) / 100;
  var fpu_rounded = Math.round(2 * fpu) / 2;
  var cdi = (cu_rounded + fpu_rounded) * carb_insulin_ratio / 10;
  var cu_perc = cu_rounded / (cu_rounded + fpu_rounded);
  var bolus_now_units;
  if (cu_perc <= 0.2) {
    bolus_now_units = 0;
  } else if (cu_perc > 0.2) {
    bolus_now_units = 10 * cu_rounded / carb_insulin_ratio;
  } else {
    bolus_now_units = "N/A";
  }
  var extended_bolus_units;
  if (fpu_rounded < 1) {
    extended_bolus_units = 0;
  } else if (cu_perc <= 0.8) {
    extended_bolus_units = 10 * fpu_rounded / carb_insulin_ratio;
  } else if (cu_perc > 0.8) {
    extended_bolus_units = 0;
  } else {
    extended_bolus_units = "N/A";
  }
  var extended_bolus_hours;
  if(fpu_rounded < 1) {
    extended_bolus_hours = 0;
  } else if (cu_perc > 0.8) {
    extended_bolus_hours = 0;
  } else if (fpu_rounded >= 1 && fpu_rounded < 2) {
    extended_bolus_hours = 3;
  } else if (fpu_rounded >= 2 && fpu_rounded < 3) {
    extended_bolus_hours = 4;
  } else if (fpu_rounded >= 3 && fpu_rounded < 4) {
    extended_bolus_hours = 5;
  } else if(fpu_rounded > 4) {
    extended_bolus_hours = 8;
  } else {
    extended_bolus_hours = "N/A";
  }

  if (bolus_now_units != "N/A") {
      bolus_now_units = Math.round(100 * bolus_now_units) / 100;
  }
  document.getElementById("bolus_now_units").innerHTML = bolus_now_units;
  if (extended_bolus_units != "N/A") {
      extended_bolus_units = Math.round(100 * extended_bolus_units) / 100;
  }
  document.getElementById("extended_bolus_units").innerHTML = extended_bolus_units;
  document.getElementById("extended_bolus_hours").innerHTML = extended_bolus_hours;
}
</script>

</body>
</html>
